---
phase: 09-overview-tab
plan: 02
type: execute
wave: 2
depends_on: [09-01]
files_modified:
  - tools/gsd-review-broker/dashboard/src/pages/index.astro
  - tools/gsd-review-broker/dashboard/src/components/OverviewStatus.astro
  - tools/gsd-review-broker/dashboard/src/components/OverviewStats.astro
  - tools/gsd-review-broker/dashboard/src/components/OverviewReviewers.astro
  - tools/gsd-review-broker/dashboard/src/scripts/overview.ts
  - tools/gsd-review-broker/dashboard/dist/index.html
autonomous: true
requirements: [OVER-01, OVER-02, OVER-03]

must_haves:
  truths:
    - "Overview tab displays broker status with version, uptime, address, and config settings"
    - "Overview tab displays aggregate review stats with total reviews, approval rate, and average times"
    - "Overview tab displays active reviewer list with status, reviews completed, and current assignment"
    - "All data updates live via SSE without page refresh"
    - "Tab renders correctly in both dark and light themes"
  artifacts:
    - path: "tools/gsd-review-broker/dashboard/src/components/OverviewStatus.astro"
      provides: "Broker status display component"
      contains: "broker-status"
    - path: "tools/gsd-review-broker/dashboard/src/components/OverviewStats.astro"
      provides: "Review statistics display component"
      contains: "review-stats"
    - path: "tools/gsd-review-broker/dashboard/src/components/OverviewReviewers.astro"
      provides: "Active reviewer list component"
      contains: "reviewer-list"
    - path: "tools/gsd-review-broker/dashboard/src/scripts/overview.ts"
      provides: "Overview data fetching and SSE subscription"
      contains: "overview_update"
    - path: "tools/gsd-review-broker/dashboard/dist/index.html"
      provides: "Rebuilt static output with overview components"
      min_lines: 50
  key_links:
    - from: "tools/gsd-review-broker/dashboard/src/scripts/overview.ts"
      to: "/dashboard/api/overview"
      via: "fetch() for initial data load"
      pattern: "fetch.*api/overview"
    - from: "tools/gsd-review-broker/dashboard/src/scripts/overview.ts"
      to: "window.gsdSSE"
      via: "SSE subscription for live updates â€” subscribes to 'overview_update' which matches data.type dispatched by sse.ts onmessage handler"
      pattern: "gsdSSE.subscribe.*overview_update"
    - from: "tools/gsd-review-broker/dashboard/src/pages/index.astro"
      to: "OverviewStatus|OverviewStats|OverviewReviewers"
      via: "Astro component imports in the Overview tab section"
      pattern: "import.*Overview"
---

<objective>
Build the Astro frontend components for the Overview tab, replacing the placeholder content with live broker status, review statistics, and active reviewer list.

Purpose: This is what the user actually sees. The data API from Plan 01 is useless without a well-designed frontend to render it. DASH-02 (frontend-design skill) applies here for a polished, distinctive interface.

Output: Three new Astro components, one TypeScript data script, updated index.astro, rebuilt dist/.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dashboard-shell-and-infrastructure/08-01-SUMMARY.md
@.planning/phases/09-overview-tab/09-01-SUMMARY.md
@tools/gsd-review-broker/dashboard/src/pages/index.astro
@tools/gsd-review-broker/dashboard/src/layouts/Layout.astro
@tools/gsd-review-broker/dashboard/src/styles/design-tokens.css
@tools/gsd-review-broker/dashboard/src/scripts/sse.ts
@tools/gsd-review-broker/dashboard/src/components/Sidebar.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Overview tab Astro components and data script</name>
  <files>
    tools/gsd-review-broker/dashboard/src/components/OverviewStatus.astro
    tools/gsd-review-broker/dashboard/src/components/OverviewStats.astro
    tools/gsd-review-broker/dashboard/src/components/OverviewReviewers.astro
    tools/gsd-review-broker/dashboard/src/scripts/overview.ts
    tools/gsd-review-broker/dashboard/src/pages/index.astro
  </files>
  <action>
Create three Astro components and a TypeScript data script for the Overview tab. Apply the frontend-design skill (DASH-02) for a polished, distinctive interface. Use the existing design token system exclusively -- no inline colors or hardcoded values.

**1. OverviewStatus.astro (OVER-01: Broker status and config)**

A status hero section at the top of the overview tab displaying broker health at a glance.

Layout: A card (`.status-card`) with the broker's health state. Inside, use a grid of key-value pairs:
- **Status indicator:** A colored dot + "Online" text (green/--color-success when connected, red/--color-error when not). Use a `data-status` attribute on the dot element that overview.ts will update.
- **Version:** Display `v{version}` (e.g., "v0.1.0")
- **Uptime:** Human-readable uptime (e.g., "2h 15m 30s") -- formatted by overview.ts
- **Address:** The broker's bind address (e.g., "0.0.0.0:8321")
- **Config items** in a subtle sub-grid: mode, model_profile, review_granularity, execution_mode, pool status

Card styling:
- Background: `var(--color-surface)`, border: `1px solid var(--color-border)`, border-radius: `var(--border-radius)`
- Padding: `var(--spacing-lg)`
- Use a subtle left accent border (3px solid var(--color-accent)) for visual distinction
- Key labels: `var(--color-text-secondary)`, font-size: `var(--font-size-xs)`, text-transform: uppercase, letter-spacing: 1px
- Values: `var(--color-text)`, font-size: `var(--font-size-base)` or `var(--font-size-lg)` for version/uptime

HTML structure (all data rendered by JS, so use placeholder elements with data attributes/IDs):
```html
<div class="status-card">
  <div class="status-header">
    <span class="status-dot" id="broker-status-dot"></span>
    <span class="status-label" id="broker-status-label">Connecting...</span>
  </div>
  <div class="status-grid">
    <div class="status-item">
      <span class="status-key">Version</span>
      <span class="status-value" id="broker-version">--</span>
    </div>
    <div class="status-item">
      <span class="status-key">Uptime</span>
      <span class="status-value" id="broker-uptime">--</span>
    </div>
    <div class="status-item">
      <span class="status-key">Address</span>
      <span class="status-value" id="broker-address">--</span>
    </div>
  </div>
  <div class="config-grid" id="broker-config">
    <!-- Config items populated by JS -->
  </div>
</div>
```

Scoped styles using Astro's `<style>` block with design token variables.

**2. OverviewStats.astro (OVER-02: Aggregate review statistics)**

A stats grid showing review metrics in a visually distinctive card layout.

Layout: A row of stat cards (3-4 cards) using CSS grid (auto-fill, minmax for responsive).

Stat cards to show:
- **Total Reviews:** Large number with label. ID: `stat-total-reviews`
- **Approval Rate:** Percentage with a subtle progress indicator or colored text. ID: `stat-approval-rate`
- **Avg Review Time:** Formatted duration. ID: `stat-avg-time`
- **Status Breakdown:** Mini bar or compact list showing pending/claimed/approved/changes_requested/closed counts. Container ID: `stat-status-breakdown`

Each stat card:
- Background: `var(--color-surface)`
- Border: `1px solid var(--color-border)`, border-radius: `var(--border-radius)`
- Padding: `var(--spacing-md)`
- Large value: font-size `var(--font-size-xl)`, color `var(--color-accent)` for emphasis
- Label below: font-size `var(--font-size-xs)`, color `var(--color-text-secondary)`, uppercase

For the status breakdown, use small colored dots/chips:
- pending: `var(--color-warning)`
- claimed: `var(--color-accent)`
- approved: `var(--color-success)`
- changes_requested: `var(--color-error)`
- closed: `var(--color-text-secondary)`

All values are placeholder (`--`) until populated by overview.ts.

**3. OverviewReviewers.astro (OVER-03: Active reviewer list)**

A table/list showing active reviewer subprocesses.

Layout: A section with a heading and either:
- A table with columns: Name, Status, PID, Current Review, Reviews Done, Uptime
- Or a card-per-reviewer layout if pool is small

Use a table approach (more informative, better for scanning):

```html
<div class="reviewers-section">
  <h3 class="section-heading">Active Reviewers</h3>
  <div class="reviewers-empty" id="reviewers-empty">
    <p>No active reviewers. Pool is idle or not configured.</p>
  </div>
  <div class="reviewers-table-wrap" id="reviewers-table-wrap" style="display:none">
    <table class="reviewers-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Status</th>
          <th>PID</th>
          <th>Current Review</th>
          <th>Reviews</th>
          <th>Approvals</th>
          <th>Uptime</th>
        </tr>
      </thead>
      <tbody id="reviewers-tbody">
        <!-- Rows populated by JS -->
      </tbody>
    </table>
  </div>
</div>
```

Table styling:
- Full width, border-collapse: collapse
- Header: font-size `var(--font-size-xs)`, color `var(--color-text-secondary)`, uppercase, letter-spacing 1px, border-bottom `1px solid var(--color-border)`, text-align left
- Rows: border-bottom `1px solid var(--color-border)`, hover background `var(--color-surface-hover)`
- Cells: padding `var(--spacing-sm) var(--spacing-md)`, font-size `var(--font-size-sm)`
- Status column: use colored dot + text (active=green, draining=yellow, terminated=red)
- "Reviews" and "Approvals" columns: right-aligned numbers
- Empty state: centered text, color `var(--color-text-secondary)`

Section heading styling:
- font-size `var(--font-size-base)`, font-weight 600, color `var(--color-text)`, margin-bottom `var(--spacing-md)`

**4. overview.ts (Data fetching + SSE subscription)**

TypeScript script that:
1. On DOMContentLoaded, fetches initial data from `/dashboard/api/overview`
2. Subscribes to SSE `overview_update` events via `window.gsdSSE.subscribe('overview_update', callback)`
3. Renders data into the DOM elements created by the three components

**SSE contract clarification:** The subscription `window.gsdSSE.subscribe('overview_update', callback)` works because:
- The backend (Plan 01) sends SSE messages in default/unnamed format: `data: {"type": "overview_update", ...}\n\n`
- The sse.ts client receives these via `eventSource.onmessage` (no `event:` prefix needed)
- sse.ts parses the JSON and dispatches to subscribers by `data.type` (line 35 of sse.ts)
- So `subscribe('overview_update', cb)` matches when `data.type === 'overview_update'`

No changes to sse.ts are needed. The existing dispatch-by-type mechanism handles this natively.

Functions:
- `async function fetchOverview(): Promise<OverviewData>` -- fetches from `/dashboard/api/overview`, returns parsed JSON
- `function renderStatus(data: OverviewData['broker']): void` -- updates status dot, version, uptime, address, config grid
- `function renderStats(data: OverviewData['stats']): void` -- updates stat cards with formatted values
- `function renderReviewers(data: OverviewData['reviewers']): void` -- populates or clears the reviewer table
- `function formatUptime(seconds: number): string` -- converts seconds to "Xh Ym Zs" format
- `function formatDuration(seconds: number | null): string` -- converts seconds to human-readable, or "--" if null
- `function init(): void` -- called on DOMContentLoaded, fetches + subscribes

Type definitions:
```typescript
interface OverviewData {
  broker: {
    version: string;
    uptime_seconds: number;
    address: string;
    config: Record<string, unknown>;
  };
  stats: {
    total_reviews: number;
    by_status: Record<string, number>;
    by_category: Record<string, number>;
    approval_rate_pct: number | null;
    avg_time_to_verdict_seconds: number | null;
    avg_review_duration_seconds: number | null;
  };
  reviewers: {
    pool_active: boolean;
    session_token: string | null;
    pool_size: number;
    reviewers: ReviewerInfo[];
  };
}

interface ReviewerInfo {
  id: string;
  display_name: string;
  status: string;
  pid: number;
  spawned_at: string;
  last_active_at: string;
  reviews_completed: number;
  total_review_seconds: number;
  approvals: number;
  rejections: number;
  current_review: string | null;
}
```

For uptime in the status section, update it every second using a local `setInterval` that increments the uptime_seconds value received from the last API/SSE response.

Error handling: If fetch fails, show "Unable to connect" in the status section. SSE errors are already handled by the SSE manager (ConnectionStatus component shows disconnected state).

**5. Update index.astro:**

Replace the Overview tab placeholder content with the three new components:

```astro
---
import Layout from '../layouts/Layout.astro';
import OverviewStatus from '../components/OverviewStatus.astro';
import OverviewStats from '../components/OverviewStats.astro';
import OverviewReviewers from '../components/OverviewReviewers.astro';
---

<Layout title="GSD Tandem Dashboard">
  <section id="tab-overview" class="tab-panel">
    <OverviewStatus />
    <OverviewStats />
    <OverviewReviewers />
  </section>
  ...other tabs unchanged...
</Layout>
```

Add the overview.ts script tag in Layout.astro OR include it directly in index.astro:
```html
<script src="../scripts/overview.ts"></script>
```

Add it after the existing SSE script (since overview.ts depends on window.gsdSSE being available). If adding in index.astro, place it at the bottom of the file. If the script needs to be in Layout.astro to be bundled, add it there after the sse.ts script tag.

Keep the existing tab-panel styles. Remove the placeholder `<h2>` and `<p>` for the overview tab only (other tabs keep their placeholders).

Add spacing between the three overview sections using a simple gap utility or margin-bottom on each component's root element.
  </action>
  <verify>
Run `cd C:/Projects/gsd-tandem/tools/gsd-review-broker/dashboard && npm run build` -- build succeeds with zero errors.
Verify `dist/index.html` contains the overview component markup (status-card, review-stats, reviewer-list class names or IDs).
Verify `dist/_astro/` contains the bundled overview.ts script code (search for "overview_update" or "api/overview" in the JS output).
  </verify>
  <done>
Overview tab renders three sections (broker status, review stats, active reviewers) with the design token system. overview.ts fetches initial data from /dashboard/api/overview and subscribes to SSE overview_update events via window.gsdSSE.subscribe('overview_update', ...) which works because the backend sends default-format SSE messages with data.type='overview_update' that sse.ts dispatches natively. All data updates live without page refresh. Built dist/ contains the complete Overview tab. Other tabs unchanged.
  </done>
</task>

</tasks>

<verification>
1. `cd tools/gsd-review-broker/dashboard && npm run build` -- succeeds
2. `dist/index.html` contains overview component markup (not placeholder text)
3. Bundled JS references `/dashboard/api/overview` and `overview_update`
4. All three requirement sections are present: broker status (OVER-01), review stats (OVER-02), reviewer list (OVER-03)
5. Components use only design token CSS variables (no hardcoded colors)
6. Dark and light theme variables are the only color source
</verification>

<success_criteria>
- Overview tab shows broker status section with version, uptime (ticking), address, and config settings (OVER-01)
- Overview tab shows stats grid with total reviews, approval rate, average review time, and status breakdown (OVER-02)
- Overview tab shows reviewer table with name, status, PID, current review, reviews completed, approvals, and uptime (OVER-03)
- All data loads on page open and updates live via SSE (overview_update dispatched by sse.ts data.type mechanism)
- Visual quality matches DASH-02 standard: polished design tokens, consistent spacing, responsive grid, proper dark/light theme support
- Astro build succeeds and dist/ is updated
</success_criteria>

<output>
After completion, create `.planning/phases/09-overview-tab/09-02-SUMMARY.md`
</output>
