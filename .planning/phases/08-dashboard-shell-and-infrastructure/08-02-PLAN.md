---
phase: 08-dashboard-shell-and-infrastructure
plan: 02
type: execute
wave: 2
depends_on:
  - 08-01
files_modified:
  - tools/gsd-review-broker/tests/test_dashboard.py
autonomous: false
requirements:
  - DASH-01
  - DASH-02

must_haves:
  truths:
    - "Dashboard route returns HTTP 200 with text/html content type"
    - "Dashboard HTML contains all four navigation sections (Overview, Logs, Reviews, Pool)"
    - "Dashboard HTML contains no external URL references (no CDN, no http:// src/href)"
    - "SSE events endpoint returns text/event-stream content type"
    - "Dashboard is visually polished with the neon-cyan dark theme when viewed in a browser"
  artifacts:
    - path: "tools/gsd-review-broker/tests/test_dashboard.py"
      provides: "Automated tests for dashboard HTTP routes"
      min_lines: 60
  key_links:
    - from: "tools/gsd-review-broker/tests/test_dashboard.py"
      to: "tools/gsd-review-broker/src/gsd_review_broker/dashboard.py"
      via: "imports dashboard functions and tests route responses"
      pattern: "from gsd_review_broker.dashboard import"
---

<objective>
Validate the dashboard shell with automated tests and visual human verification. Tests confirm route responses, content structure, and self-containment. Human verification confirms the visual design matches the locked decisions (dark theme, neon cyan accent, left sidebar, monospace typography).

Purpose: Ensure the dashboard foundation is solid before subsequent phases build feature tabs on top of it.
Output: Passing test suite and human-verified visual confirmation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dashboard-shell-and-infrastructure/08-01-SUMMARY.md
@tools/gsd-review-broker/tests/conftest.py
@tools/gsd-review-broker/src/gsd_review_broker/dashboard.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create automated tests for dashboard routes</name>
  <files>tools/gsd-review-broker/tests/test_dashboard.py</files>
  <action>
Create `test_dashboard.py` with tests for the dashboard module. These tests call the route handler functions directly (same pattern as the rest of the broker test suite -- call the function, inspect the response) rather than spinning up a full HTTP server.

Import the route handler functions from `dashboard.py`. The `register_dashboard_routes` function decorates handlers with `mcp.custom_route`, but the inner functions should also be importable or testable. If the handlers are nested inside `register_dashboard_routes`, an alternative approach is to test by importing the module and calling `register_dashboard_routes` on a mock, then invoking the captured handler directly.

Practical approach: Import the HTML content generation and SSE generator separately. Structure dashboard.py exports (or module-level constants) to make testing straightforward. If needed, refactor dashboard.py slightly to expose `build_dashboard_html()` as a standalone function and `sse_event_generator()` as an importable async generator factory.

**Tests to write:**

1. `test_dashboard_html_contains_branding` -- The HTML output contains "GSD Tandem" text
2. `test_dashboard_html_contains_nav_sections` -- HTML contains all four nav items: "Overview", "Logs", "Reviews", "Pool"
3. `test_dashboard_html_no_external_urls` -- HTML does not contain `src="http` or `href="http` or `url("http` patterns (confirming self-containment, DASH-01 requirement). Allow `http://127.0.0.1` and `http://localhost` patterns since those are the SSE endpoint references.
4. `test_dashboard_html_contains_theme_toggle` -- HTML contains theme toggle mechanism (data-theme attribute, localStorage reference)
5. `test_dashboard_html_contains_css_variables` -- HTML contains CSS custom property definitions (--bg-primary, --accent-primary, or similar)
6. `test_dashboard_html_contains_sse_setup` -- HTML contains EventSource and /dashboard/events reference
7. `test_dashboard_html_contains_monospace_font` -- HTML contains monospace font-family declaration
8. `test_sse_generator_yields_connected_event` -- The SSE async generator yields a "connected" event as its first message. Use `asyncio.wait_for` with a short timeout to get the first yielded value, verify it contains "event: connected" and version info.
9. `test_sse_generator_yields_heartbeat` -- After the connected event, the generator yields heartbeat events. Mock `asyncio.sleep` to avoid waiting 15 seconds, verify the heartbeat format contains "event: heartbeat".

For the SSE tests, use `asyncio.wait_for` with a 2-second timeout. Mock `asyncio.sleep` in the heartbeat test to return immediately so the test doesn't wait 15 seconds.

Follow existing test patterns: use `pytest` and `pytest-asyncio` (auto mode), keep tests as simple async functions.
  </action>
  <verify>
Run `uv run pytest tests/test_dashboard.py -v` from the broker directory. All tests should pass. Then run the full suite `uv run pytest tests/ -x -q` to confirm no regressions.
  </verify>
  <done>
test_dashboard.py exists with 9 tests covering HTML content, self-containment, theme toggle, CSS variables, SSE setup, and SSE event generation. All tests pass. Full test suite has no regressions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of dashboard shell</name>
  <action>
Human verifies the dashboard visually in a browser. This is a checkpoint -- no code changes, just confirmation that the visual design and interactive behavior match the locked decisions from the discuss phase.

What was built:
- Complete dashboard shell served from the broker at /dashboard
- Dark theme with neon cyan accent color (#00d4ff) on dark background (#1a1a2e)
- Left sidebar with "GSD Tandem" branding, four nav items (Overview, Logs, Reviews, Pool)
- Tab switching between placeholder content panels
- Dark/light mode toggle (sun/moon button) with localStorage persistence
- Connection status indicator at bottom of sidebar (green/red dot with SSE heartbeat)
- Full monospace typography throughout
- Self-contained -- no external dependencies

How to verify:
1. Start the broker if not already running: `cd tools/gsd-review-broker and run uv run gsd-review-broker`
2. Open http://127.0.0.1:8321/dashboard in a browser
3. Verify visual appearance:
   - Dark theme with neon cyan/teal accents
   - Left sidebar with "GSD Tandem" at top
   - Four nav items: Overview, Logs, Reviews, Pool
   - Monospace font throughout
4. Click each nav item -- content panel should switch without page reload
5. Click the theme toggle -- should switch between dark and light modes
6. Refresh the page -- theme preference should persist
7. Check connection indicator at bottom of sidebar -- should show "Connected" with green dot
8. Open browser dev tools Network tab -- confirm no external requests (only /dashboard and /dashboard/events)

Resume: Type "approved" if the dashboard looks good, or describe any visual/functional issues to fix.
  </action>
  <verify>Human confirms visual approval</verify>
  <done>Human has verified the dashboard shell matches the locked design decisions and all interactive features work correctly.</done>
</task>

</tasks>

<verification>
1. `uv run pytest tests/test_dashboard.py -v` -- all 9 dashboard tests pass
2. `uv run pytest tests/ -x -q` -- full test suite passes (145+ existing tests plus new dashboard tests)
3. Visual inspection confirms dark neon-cyan theme, left sidebar, tab switching, and self-containment
4. Browser dev tools confirm zero external network requests
</verification>

<success_criteria>
- All dashboard tests pass validating HTML content, self-containment, and SSE events
- Human confirms visual design matches locked decisions (dark theme, neon cyan, left sidebar, monospace)
- Human confirms tab switching works for all four sections
- Human confirms dark/light mode toggle works and persists across refresh
- Human confirms connection indicator shows green/connected state
- Full test suite has no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-shell-and-infrastructure/08-02-SUMMARY.md`
</output>
