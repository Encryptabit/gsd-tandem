---
phase: 08-dashboard-shell-and-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tools/gsd-review-broker/src/gsd_review_broker/dashboard.py
  - tools/gsd-review-broker/src/gsd_review_broker/server.py
autonomous: true
requirements:
  - DASH-01
  - DASH-02

must_haves:
  truths:
    - "User can navigate to http://127.0.0.1:8321/dashboard and see a styled HTML page"
    - "Dashboard displays a left sidebar with Overview, Logs, Reviews, Pool navigation items"
    - "Clicking a sidebar nav item switches the visible content panel without page reload"
    - "Dashboard has a dark theme by default with a working sun/moon light mode toggle"
    - "Dashboard loads without any external CDN or network dependencies -- all CSS and JS are inline"
    - "Connection status indicator at bottom of sidebar shows broker connection health via SSE"
    - "GSD Tandem text-only branding appears at top of sidebar"
  artifacts:
    - path: "tools/gsd-review-broker/src/gsd_review_broker/dashboard.py"
      provides: "Dashboard HTTP route handlers and HTML content"
      exports: ["register_dashboard_routes"]
    - path: "tools/gsd-review-broker/src/gsd_review_broker/server.py"
      provides: "Updated server importing and registering dashboard routes"
      contains: "register_dashboard_routes"
  key_links:
    - from: "tools/gsd-review-broker/src/gsd_review_broker/server.py"
      to: "tools/gsd-review-broker/src/gsd_review_broker/dashboard.py"
      via: "import and call register_dashboard_routes(mcp)"
      pattern: "register_dashboard_routes"
    - from: "dashboard.py /dashboard route"
      to: "dashboard.py /dashboard/events SSE route"
      via: "client-side EventSource in inline JS connecting to /dashboard/events"
      pattern: "EventSource.*dashboard/events"
---

<objective>
Build the complete web dashboard shell served from the running broker process. This creates the /dashboard HTTP route returning a self-contained HTML page with the full design system (dark/neon-cyan theme, monospace typography, left sidebar navigation), tab switching for four placeholder content areas (Overview, Logs, Reviews, Pool), dark/light mode toggle, and an SSE-based connection status indicator.

Purpose: Establishes the visual foundation and navigation infrastructure that all subsequent dashboard feature phases (9-12) will plug content into.
Output: Working dashboard page at http://127.0.0.1:8321/dashboard with complete navigation shell.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@tools/gsd-review-broker/src/gsd_review_broker/server.py
@tools/gsd-review-broker/src/gsd_review_broker/db.py
@tools/gsd-review-broker/pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard module with HTML shell, design system, and route handlers</name>
  <files>tools/gsd-review-broker/src/gsd_review_broker/dashboard.py</files>
  <action>
Create a new `dashboard.py` module in the broker package that provides a `register_dashboard_routes(mcp)` function. This function uses `mcp.custom_route` (FastMCP's Starlette route decorator) to register two HTTP endpoints.

**Route 1: GET /dashboard**

Returns an `HTMLResponse` (from `starlette.responses`) containing a complete, self-contained HTML page. All CSS and JS must be inline -- no external stylesheet or script references, no CDN links, no font imports. The page must work entirely offline once loaded.

**Design system (per user decisions -- these are LOCKED):**

Dark theme (default):
- Background: #1a1a2e (very dark blue-gray, within the #1a1a1a-#1e1e1e range but with slight cool tint to complement cyan)
- Surface/cards: #16213e (slightly lighter for panels)
- Sidebar background: #0f3460 (deeper blue to differentiate)
- Text primary: #e0e0e0
- Text secondary: #a0a0a0
- Accent primary: #00d4ff (neon cyan)
- Accent hover: #00e5ff (slightly brighter for interactive states)
- Accent glow: rgba(0, 212, 255, 0.15) (subtle glow for focused elements)
- Border: rgba(0, 212, 255, 0.2)
- Monospace font: `'Cascadia Code', 'JetBrains Mono', 'Fira Code', 'SF Mono', 'Consolas', monospace` (system mono stack, no web font import)

Light theme:
- Background: #f5f5f5
- Surface: #ffffff
- Sidebar background: #e8e8e8
- Text primary: #1a1a1a
- Text secondary: #555555
- Accent primary: #0088aa (darker cyan for readability on light)
- Border: rgba(0, 136, 170, 0.3)

**Layout (per user decisions -- LOCKED):**

Left sidebar navigation, approximately 220px wide:
- Top: "GSD Tandem" text branding in accent color, monospace, bold
- Below branding: version number (small text, read from `__version__`)
- Nav items: Overview, Logs, Reviews, Pool -- each as a clickable item with an icon (use simple Unicode symbols: clipboard, scroll, magnifying glass, server -- no icon library)
- Each nav item has a badge area for future live counts (render as empty span with class `badge`, hidden by default)
- Active nav item highlighted with accent background color and left border indicator
- Bottom of sidebar: connection status indicator (green dot + "Connected" / red dot + "Disconnected") -- wired in Task 2
- Dark/light mode toggle button (sun/moon Unicode symbols) above connection status

**Main content area:**

Right of sidebar, takes remaining width. Contains four tab panels (div elements), one per nav section. Only the active panel is visible (display:none/block toggling). Each panel has:
- A heading with the section name
- Placeholder text: "Coming in Phase {N}" where N is 9/10/11/12 respectively
- A subtle border and padding to define the content area

**JavaScript (inline):**

- Tab switching: clicking a sidebar nav item sets `data-active-tab` attribute on body, shows corresponding panel, updates sidebar active state
- Theme toggle: clicking the toggle button swaps a `data-theme="light"` attribute on `<html>`, stores preference in localStorage, reads on page load
- CSS variables approach: define all colors as CSS custom properties on `:root` and `[data-theme="light"]`, so the entire theme switches via one attribute change
- On page load: restore theme from localStorage, default to dark if no preference

**Route 2: GET /dashboard/events (SSE endpoint)**

Returns a `StreamingResponse` (from `starlette.responses`) with `content_type="text/event-stream"` and headers `Cache-Control: no-cache`, `Connection: keep-alive`, `X-Accel-Buffering: no`.

The SSE endpoint:
- Sends a `heartbeat` event every 15 seconds containing `{"status": "connected", "timestamp": <ISO8601>}`
- On initial connection, sends a `connected` event with `{"broker": "gsd-review-broker", "version": <version>}`
- Uses an async generator that yields SSE-formatted strings (`event: <type>\ndata: <json>\n\n`)
- Catches `asyncio.CancelledError` to handle client disconnects gracefully
- Import `__version__` from `gsd_review_broker` for the version field

The function signature for `register_dashboard_routes` takes the FastMCP `mcp` instance and calls `mcp.custom_route(...)` as a decorator on each handler function.
  </action>
  <verify>
Run `python -c "from gsd_review_broker.dashboard import register_dashboard_routes; print('import ok')"` from the broker directory. Verify the module imports without error. Then check that the HTML string contains key markers: "GSD Tandem", "data-theme", "EventSource", "/dashboard/events", "Overview", "Logs", "Reviews", "Pool", no "href=\"http" or "src=\"http" (confirming no external dependencies).
  </verify>
  <done>
dashboard.py exists with register_dashboard_routes function that registers /dashboard and /dashboard/events routes. The HTML contains the complete design system, left sidebar navigation, four tab panels, dark/light toggle, and SSE connection setup. Zero external resource references.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire dashboard routes into broker server and verify end-to-end</name>
  <files>tools/gsd-review-broker/src/gsd_review_broker/server.py</files>
  <action>
Modify `server.py` to import and activate the dashboard routes:

1. Add import near the top (after `mcp` is created, alongside the existing `from gsd_review_broker import tools` import):
   ```python
   from gsd_review_broker.dashboard import register_dashboard_routes
   ```

2. Call `register_dashboard_routes(mcp)` immediately after the import. This must happen AFTER `mcp = FastMCP(...)` is defined but can be alongside the tools import section (the module-level side-effect imports area around line 44).

3. The import order should be:
   - `mcp = FastMCP(...)` (already exists)
   - `from gsd_review_broker import tools` (already exists)
   - `from gsd_review_broker.dashboard import register_dashboard_routes` (new)
   - `register_dashboard_routes(mcp)` (new)

Do NOT add any new dependencies to pyproject.toml -- starlette is already available transitively through FastMCP.

Verify the server still starts correctly by running `python -c "from gsd_review_broker.server import mcp; print('server import ok')"` from the broker source directory.
  </action>
  <verify>
Run `python -c "from gsd_review_broker.server import mcp; print(type(mcp))"` to confirm server module loads without import errors. Run existing test suite `uv run pytest tests/ -x -q` from the broker directory to confirm no regressions. If broker is running, `curl http://127.0.0.1:8321/dashboard` should return HTML with status 200.
  </verify>
  <done>
server.py imports and registers dashboard routes. All existing tests still pass. The /dashboard and /dashboard/events routes are registered on the FastMCP instance and will be served when the broker starts.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from gsd_review_broker.dashboard import register_dashboard_routes"` succeeds
2. `python -c "from gsd_review_broker.server import mcp"` succeeds
3. `uv run pytest tests/ -x -q` passes with no regressions
4. The HTML content in dashboard.py contains: "GSD Tandem", sidebar nav items, CSS custom properties, EventSource setup, no external URLs
5. No new entries in pyproject.toml dependencies
</verification>

<success_criteria>
- /dashboard route registered returning self-contained HTML with dark neon-cyan theme
- /dashboard/events SSE route registered sending heartbeat events
- Left sidebar with Overview, Logs, Reviews, Pool navigation that switches content panels
- Dark/light mode toggle with localStorage persistence
- Connection status indicator wired to SSE heartbeat
- All existing broker tests pass
- Zero external CDN/network dependencies in the HTML
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-shell-and-infrastructure/08-01-SUMMARY.md`
</output>
