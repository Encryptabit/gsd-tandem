---
phase: 08-dashboard-shell-and-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tools/gsd-review-broker/dashboard/package.json
  - tools/gsd-review-broker/dashboard/astro.config.mjs
  - tools/gsd-review-broker/dashboard/tsconfig.json
  - tools/gsd-review-broker/dashboard/src/layouts/Layout.astro
  - tools/gsd-review-broker/dashboard/src/pages/index.astro
  - tools/gsd-review-broker/dashboard/src/styles/design-tokens.css
  - tools/gsd-review-broker/dashboard/src/components/Sidebar.astro
  - tools/gsd-review-broker/dashboard/src/components/ThemeToggle.astro
  - tools/gsd-review-broker/dashboard/src/components/ConnectionStatus.astro
  - tools/gsd-review-broker/dashboard/src/components/TabPanel.astro
  - tools/gsd-review-broker/dashboard/src/scripts/sse.ts
  - tools/gsd-review-broker/dashboard/src/scripts/theme.ts
  - tools/gsd-review-broker/dashboard/src/scripts/tabs.ts
  - tools/gsd-review-broker/dashboard/dist/
autonomous: true
requirements:
  - DASH-01
  - DASH-02

must_haves:
  truths:
    - "Astro project builds to static HTML/CSS/JS in dashboard/dist/ with zero errors"
    - "Built index.html contains left sidebar with four nav items (Overview, Logs, Reviews, Pool)"
    - "Built output has no external CDN or network dependency references"
    - "Dark theme is the default with neon cyan/teal accent colors visible in the CSS"
    - "Light mode toggle mechanism exists in the built JavaScript"
    - "Tab switching logic changes visible content panels without page reload"
    - "SSE utility module exists for shared EventSource connection"
    - "Connection status indicator is present in the sidebar bottom area"
    - "Full monospace typography is applied throughout"
  artifacts:
    - path: "tools/gsd-review-broker/dashboard/package.json"
      provides: "Astro project configuration and build scripts"
      contains: "astro"
    - path: "tools/gsd-review-broker/dashboard/astro.config.mjs"
      provides: "Astro build configuration with /dashboard base path"
      contains: "defineConfig"
    - path: "tools/gsd-review-broker/dashboard/src/layouts/Layout.astro"
      provides: "Root HTML layout with sidebar + main content area"
      min_lines: 30
    - path: "tools/gsd-review-broker/dashboard/src/styles/design-tokens.css"
      provides: "CSS custom properties for dark/light themes, accent colors, typography"
      min_lines: 40
    - path: "tools/gsd-review-broker/dashboard/src/components/Sidebar.astro"
      provides: "Left sidebar navigation with nav items, badges, branding, connection status"
      min_lines: 30
    - path: "tools/gsd-review-broker/dashboard/src/components/ThemeToggle.astro"
      provides: "Dark/light mode toggle button with sun/moon icons"
      min_lines: 15
    - path: "tools/gsd-review-broker/dashboard/src/components/ConnectionStatus.astro"
      provides: "SSE connection status indicator (connected/disconnected/reconnecting)"
      min_lines: 15
    - path: "tools/gsd-review-broker/dashboard/src/scripts/sse.ts"
      provides: "Shared EventSource connection utility for SSE"
      min_lines: 20
    - path: "tools/gsd-review-broker/dashboard/dist/index.html"
      provides: "Built static HTML entry point"
      min_lines: 10
  key_links:
    - from: "tools/gsd-review-broker/dashboard/src/pages/index.astro"
      to: "tools/gsd-review-broker/dashboard/src/layouts/Layout.astro"
      via: "Astro layout import"
      pattern: "Layout"
    - from: "tools/gsd-review-broker/dashboard/src/layouts/Layout.astro"
      to: "tools/gsd-review-broker/dashboard/src/styles/design-tokens.css"
      via: "CSS import in layout head"
      pattern: "design-tokens"
    - from: "tools/gsd-review-broker/dashboard/src/layouts/Layout.astro"
      to: "tools/gsd-review-broker/dashboard/src/components/Sidebar.astro"
      via: "Component import"
      pattern: "Sidebar"
    - from: "tools/gsd-review-broker/dashboard/src/scripts/sse.ts"
      to: "/dashboard/events"
      via: "EventSource URL"
      pattern: "dashboard/events"
---

<objective>
Create the Astro static site project that produces the dashboard frontend shell. This plan sets up the full Astro project at `tools/gsd-review-broker/dashboard/`, implements the design system, layout, sidebar navigation, theme toggling, connection status indicator, tab panel switching, and SSE utility -- then builds to `dist/` which will be committed to the repo.

Purpose: Establish the frontend foundation that the Python broker will serve as static files. All later dashboard features (Overview, Logs, Reviews, Pool tabs) will be Astro components that plug into this shell.
Output: Built static site in `dashboard/dist/` ready to be served by the broker.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dashboard-shell-and-infrastructure/08-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Astro project and build design system with layout shell</name>
  <files>
    tools/gsd-review-broker/dashboard/package.json
    tools/gsd-review-broker/dashboard/astro.config.mjs
    tools/gsd-review-broker/dashboard/tsconfig.json
    tools/gsd-review-broker/dashboard/src/layouts/Layout.astro
    tools/gsd-review-broker/dashboard/src/pages/index.astro
    tools/gsd-review-broker/dashboard/src/styles/design-tokens.css
    tools/gsd-review-broker/dashboard/src/components/Sidebar.astro
  </files>
  <action>
Create the Astro project at `tools/gsd-review-broker/dashboard/`. Do NOT use `create-astro` interactive CLI -- manually create the project files for full control.

**package.json:** Create with `astro` as the only dependency (use latest stable, currently ^5.x). Scripts: `"dev": "astro dev"`, `"build": "astro build"`, `"preview": "astro preview"`. No other runtime dependencies -- everything is self-contained.

**astro.config.mjs:** Configure with:
- `base: '/dashboard'` (all assets served under /dashboard prefix)
- `output: 'static'` (default, but be explicit)
- `build: { format: 'file' }` so index.astro builds to index.html (not index/index.html)
- No integrations needed (pure Astro, no React/Vue)

**tsconfig.json:** Extend `"astro/tsconfigs/strict"`. This is standard Astro TypeScript config.

**design-tokens.css:** Create comprehensive CSS custom properties for the design system. Per user decision:
- Dark theme default: background `#1a1a1a` to `#1e1e1e` range, surface colors slightly lighter
- Neon cyan/teal accent: primary accent `#00e5ff` or similar high-contrast cyan, slightly brighter hover variants
- Light mode: Invert with light backgrounds (#f5f5f5 range), dark text, same accent hue but adjusted for readability
- Full monospace typography: Use system mono stack: `'SF Mono', 'Cascadia Code', 'JetBrains Mono', 'Fira Code', Consolas, 'Liberation Mono', monospace`
- Define: `--color-bg`, `--color-surface`, `--color-surface-hover`, `--color-border`, `--color-text`, `--color-text-secondary`, `--color-accent`, `--color-accent-hover`, `--color-accent-dim`, `--color-success`, `--color-warning`, `--color-error`
- Define: `--font-mono`, `--font-size-xs`, `--font-size-sm`, `--font-size-base`, `--font-size-lg`, `--font-size-xl`
- Define: `--spacing-xs`, `--spacing-sm`, `--spacing-md`, `--spacing-lg`, `--spacing-xl`
- Define: `--sidebar-width` (e.g., 240px), `--border-radius`, `--transition-speed`
- Use `[data-theme="dark"]` and `[data-theme="light"]` selectors on `<html>` element
- Default `:root` variables should be the dark theme values

**Layout.astro:** Root layout component that provides the HTML shell:
- `<!DOCTYPE html>` with `<html data-theme="dark">` (dark default per user decision)
- `<head>` with charset, viewport, title "GSD Tandem Dashboard", import design-tokens.css
- `<body>` with two-column layout: fixed sidebar on left (var(--sidebar-width) wide) + scrollable main content area
- Import and render `<Sidebar />` component in the sidebar column
- Render `<slot />` for page content in the main area
- Apply base styles: `margin: 0`, `min-height: 100vh`, monospace font, bg color from tokens
- No external CDN links -- all styles inline or from local CSS files

**Sidebar.astro:** Left sidebar navigation component:
- "GSD Tandem" text branding at the top (styled with accent color, monospace, bold)
- Navigation section with four items: Overview, Logs, Reviews, Pool
- Each nav item: text label + badge count placeholder (span with class for dynamic updates, initially showing "--")
- Nav items should have `data-tab="overview"` etc. attributes for tab switching JS
- Active state styling: accent-colored left border or background highlight
- First item (Overview) has active class by default
- Bottom section: ConnectionStatus component slot and ThemeToggle
- Sidebar is fixed position, full height, dark surface background
- Responsive: on narrow screens (<768px), sidebar could collapse or overlay (basic responsive, primary target is desktop per user decision)

**index.astro:** The single page that uses Layout:
- Import Layout
- Render four `<section>` elements with `id="tab-overview"`, `id="tab-logs"`, `id="tab-reviews"`, `id="tab-pool"`
- Each section is a tab panel container. Only "tab-overview" is visible by default (others get `style="display:none"` or a hidden class)
- Each panel has placeholder content: heading with tab name + "Coming soon" message
- This is where future phases will inject their Astro components

Run `npm install` in the dashboard directory after creating all files.
  </action>
  <verify>
Verify project structure:
- `ls tools/gsd-review-broker/dashboard/node_modules/.package-lock.json` exists (npm install succeeded)
- `ls tools/gsd-review-broker/dashboard/src/layouts/Layout.astro` exists
- `ls tools/gsd-review-broker/dashboard/src/styles/design-tokens.css` exists
- `ls tools/gsd-review-broker/dashboard/src/components/Sidebar.astro` exists
  </verify>
  <done>Astro project initialized with design system, layout shell, sidebar navigation, and page structure. npm install completed successfully.</done>
</task>

<task type="auto">
  <name>Task 2: Create interactive components, scripts, and build to dist/</name>
  <files>
    tools/gsd-review-broker/dashboard/src/components/ThemeToggle.astro
    tools/gsd-review-broker/dashboard/src/components/ConnectionStatus.astro
    tools/gsd-review-broker/dashboard/src/scripts/sse.ts
    tools/gsd-review-broker/dashboard/src/scripts/theme.ts
    tools/gsd-review-broker/dashboard/src/scripts/tabs.ts
    tools/gsd-review-broker/dashboard/dist/
  </files>
  <action>
Create the interactive components and client-side scripts, then build the project.

**ThemeToggle.astro:** Dark/light mode toggle button:
- Sun icon (for switching to light) and moon icon (for switching to dark) -- use simple SVG inline icons, NOT external icon libraries
- On click: toggle `data-theme` attribute on `<html>` between "dark" and "light"
- Persist preference in localStorage key "gsd-dashboard-theme"
- On page load: read localStorage, apply saved theme (or default to dark)
- Button styled with accent color, compact size, sits in sidebar bottom area
- Include the JS logic in a `<script>` tag within the component (Astro will bundle it)

**ConnectionStatus.astro:** SSE connection status indicator:
- Three states: "Connected" (green dot), "Disconnected" (red dot), "Reconnecting..." (yellow dot, pulsing)
- Small, compact display: colored dot + text label
- Sits at the bottom of the sidebar above the theme toggle
- Exposes a global function or custom event that the SSE utility can call to update status: `window.dispatchEvent(new CustomEvent('sse-status', { detail: { status: 'connected' } }))`
- Listens for `sse-status` custom events to update its display
- Default state: "Disconnected" (until SSE connects)

**sse.ts:** Shared EventSource utility module:
- Creates and manages a single EventSource connection to `/dashboard/events`
- Auto-reconnect with exponential backoff (1s, 2s, 4s, max 30s)
- Dispatches `sse-status` custom events on window for ConnectionStatus component
- Exports a way to subscribe to specific event types: `onSSEMessage(eventType: string, callback: (data: any) => void)`
- Handles connection lifecycle: open -> dispatch 'connected', error -> dispatch 'disconnected', reconnect -> dispatch 'reconnecting'
- Does NOT fail hard if SSE endpoint is unavailable (graceful degradation -- dashboard works without live data)
- This is the ONLY place EventSource is created -- all tabs use this shared connection
- Import this script in Layout.astro via `<script src="../scripts/sse.ts"></script>` in the body (Astro processes .ts files)

**theme.ts:** Theme initialization script:
- Runs immediately on page load (before paint if possible)
- Reads localStorage "gsd-dashboard-theme", applies to `<html data-theme="...">`
- This prevents flash of wrong theme on load
- Import in Layout.astro `<head>` with `is:inline` attribute so it runs synchronously before render

**tabs.ts:** Tab switching logic:
- Listen for clicks on sidebar nav items (use event delegation on sidebar container)
- When nav item clicked: hide all tab panels, show the matching panel, update active nav item styling
- Use `data-tab` attributes on nav items and `id="tab-{name}"` on panels for matching
- Store active tab in localStorage "gsd-dashboard-active-tab" for persistence across refreshes
- On page load: restore last active tab from localStorage (default to "overview")

**Wire everything together in Layout.astro:**
- Add `<script>` import for theme.ts in `<head>` with `is:inline` (sync, prevents FOUC)
- Add `<script>` imports for sse.ts and tabs.ts in `<body>` (can be deferred)
- Ensure ThemeToggle and ConnectionStatus are rendered inside Sidebar.astro

**Build the project:**
- Run `npm run build` from `tools/gsd-review-broker/dashboard/`
- Verify `dist/` directory is created with `index.html` and assets
- The built output should work standalone when opened in a browser (minus SSE which needs the server)

**Add .gitignore in dashboard/:**
- Ignore `node_modules/`
- Do NOT ignore `dist/` (it gets committed per user decision)

**IMPORTANT:** No external CDN links, no Google Fonts, no icon libraries loaded from network. Everything self-contained.
  </action>
  <verify>
Build verification:
- Run `npm run build` in `tools/gsd-review-broker/dashboard/` -- must exit with code 0
- Verify `tools/gsd-review-broker/dashboard/dist/index.html` exists and contains "GSD Tandem"
- Verify no external CDN references: search dist/index.html for "cdn", "googleapis", "cloudflare", "unpkg" -- should find none
- Verify sidebar nav items present in built HTML: search for "Overview", "Logs", "Reviews", "Pool"
- Verify dark theme CSS variables present in built output
- Verify monospace font-family in built CSS
  </verify>
  <done>All interactive components created, scripts wired into layout, project builds to dist/ with zero errors. Built output contains the complete dashboard shell with sidebar navigation, dark/light theme support, connection status indicator, tab switching, and SSE utility. No external dependencies in built output.</done>
</task>

</tasks>

<verification>
- `npm run build` in `tools/gsd-review-broker/dashboard/` succeeds
- `dist/index.html` contains sidebar with Overview, Logs, Reviews, Pool navigation items
- `dist/` contains no references to external CDNs or network resources
- CSS custom properties define dark and light theme color systems
- Monospace font stack applied to body
- Tab switching JS and theme toggle JS present in built output
- SSE utility targets `/dashboard/events` endpoint
</verification>

<success_criteria>
- Astro project at `tools/gsd-review-broker/dashboard/` builds cleanly to `dist/`
- Built shell has production-grade visual design with neon cyan accent on dark background
- Left sidebar navigation with Overview/Logs/Reviews/Pool items and badge placeholders
- Dark/light theme toggle persists to localStorage
- Tab switching shows/hides content panels
- SSE connection utility ready for live data (graceful when server unavailable)
- Connection status indicator in sidebar
- Zero external network dependencies in built output
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-shell-and-infrastructure/08-01-SUMMARY.md`
</output>
